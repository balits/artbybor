import { Collection, Product } from '@shopify/hydrogen/storefront-api-types';
import { Link } from "~/components"
import SmartImage from '~/components/global/SmartImage';
import { SerializeFrom } from '@shopify/remix-oxygen';
import ProductCard from '~/components/shop/ProductCard';

import Carousel, { ArrowProps, ButtonGroupProps } from "react-multi-carousel";
import { HiChevronLeft, HiChevronRight } from 'react-icons/hi';

type DefaultCarouselProps = {
  textOnTop: boolean;
}

type CollectionCarouselProps = DefaultCarouselProps & {
  collections: SerializeFrom<Collection[]>;
};

function Multi({
  collections,
  textOnTop = false
}: CollectionCarouselProps) {
  const responsive = {
    superLargeDesktop: {
      // the naming can be any, depends on you.
      breakpoint: { max: 4000, min: 3000 },
      items: 4
    },
    desktop: {
      breakpoint: { max: 3000, min: 1024 },
      items: 3
    },
    tablet: {
      breakpoint: { max: 1024, min: 464 },
      items: 2
    },
    mobile: {
      breakpoint: { max: 464, min: 0 },
      items: 1
    }
  };
  return (
    <Carousel
      responsive={responsive}
      draggable={false}
      ssr={true}
      itemClass="my-carousel-item"
      arrows={false}
      customButtonGroup={<ButtonGroup />}
    >
      {collections.map((coll) => {
        if (!coll.image) return null

        return (
            <Link  key={coll.id} to={`/collections/${coll.handle}`} prefetch="intent">
              <SmartImage
                image={coll.image}
                widths={[280, 350,450,550, 650]}
                sizes="(max-width: 768px) 80vw, 60vw"
                alt={coll.image?.altText ?? coll.title}
/*                 className="h-[300px] sm:h-auto w-carousel-item-sm md:w-carousel-item-md lg:w-carousel-item-lg " */
                className="w-full "
                loading='eager'
              />
              {textOnTop ?  (
                <div className="absolute z-[2] inset-0 w-full h-full grid place-items-center basic-animation group-hover:bg-black/10">
                  <h3 className="z-[3] text-xl md:text-2xl lg:text-3xl  font-bold uppercase text-white basic-animation opacity-0 group-hover:opacity-100">
                    {coll.title}
                  </h3>
                </div>
              ): (
                <h3 className='mt-2 lg:mt-3 xl:mt-4 font-medium text-sm md:text-md xl:text-lg'>{coll.title}</h3>
              )}
            </Link>
        )
      })}
    </Carousel>
  )
}

export function CollectionCarousel({
  collections,
  textOnTop = false
}: CollectionCarouselProps) {
  const haveCollections = collections && collections.length > 0;
  if (!haveCollections) return null;

  return Multi({collections, textOnTop})

  return (
    <ul
      className='grid w-full snap-mandatory snap-x scroll-px-6 grid-rows-1 grid-flow-col justify-start gap-6 md:gap-10 lg:gap-12 overflow-x-scroll hiddenScroll'>
      {collections.map((coll) => {
        if (!coll.image) return null
        return (
          <li key={coll.id} className="snap-center relative group cursor-pointer ">
            <Link to={`/collections/${coll.handle}`} prefetch="intent">
              <SmartImage
                image={coll.image}
                widths={[280, 350,450,550, 650]}
                sizes="(max-width: 768px) 80vw, 60vw"
                alt={coll.image?.altText ?? coll.title}
                className="h-[300px] sm:h-auto w-carousel-item-sm md:w-carousel-item-md lg:w-carousel-item-lg "
                loading='eager'
              />
              {textOnTop ?  (
                <div className="absolute z-[2] inset-0 w-full h-full grid place-items-center basic-animation group-hover:bg-black/10">
                  <h3 className="z-[3] text-xl md:text-2xl lg:text-3xl  font-bold uppercase text-white basic-animation opacity-0 group-hover:opacity-100">
                    {coll.title}
                  </h3>
                </div>
              ): (
                <h3 className='mt-2 lg:mt-3 xl:mt-4 font-medium text-sm md:text-md xl:text-lg'>{coll.title}</h3>
              )}
            </Link>
          </li>
        )
      })}
    </ul>
  );
}

type ProductCarouselProps = DefaultCarouselProps & {
  products: SerializeFrom<Product[]>;
};

/***
  * This version takes an array of Products and displays them with a `ProductCard`.
  * Please make sure that your version of Product has the following:
  * - title of the product
  * - the first variant
  * - image of the first variant
  * - price of the first variant
  * -  comparePrice of first the variant (To Be Implementedb
  * */
export function ProductCarousel({
  products,
  textOnTop,
}: ProductCarouselProps) {
  return (
    <ul className='grid w-full snap-mandatory snap-x scroll-px-6 grid-rows-1 grid-flow-col justify-start gap-6 md:gap-10 lg:gap-12 overflow-x-scroll hiddenScroll'>
      {products.map((prod) => {
        const variant = prod.variants.nodes[0];
        if(!variant.image) return null;

        return <li key={prod.id} className="snap-start relative group cursor-pointer w-carousel-item-sm md:w-carousel-item-md lg:w-carousel-item-lg ">
          <Link to={`/products/${prod.handle}`} prefetch="intent">
            <ProductCard
              title={prod.title}
              money={variant.price}
              img={variant.image}
              textOnTop={textOnTop}
            />
          </Link>
        </li>
      })}
    </ul>
  );
}

export function Skeleton() {
  return (
    <ul className='grid w-full snap-mandatory snap-x scroll-px-6 grid-rows-1 grid-flow-col justify-start gap-6 md:gap-10 lg:gap-12 overflow-x-scroll hiddenScroll'>
      {[1,2,3,4,5].map((x) => (
        <li key={x} className="snap-start relative group cursor-pointer w-carousel-item-sm md:w-carousel-item-md lg:w-carousel-item-lg " />
      ))}
    </ul>
  );
}

function RightArrow({
  onClick,
  carouselState
}: ArrowProps) {
  return <button onClick={onClick}>
    <HiChevronRight className='w-5 h-5' />
  </button>
}

function LeftArrow({
  onClick,
  carouselState
}: ArrowProps) {
  return <button onClick={onClick}>
    <HiChevronLeft className='w-5 h-5' />
  </button>
}

const ButtonGroup = ({ next, previous, goToSlide, carouselState }: ButtonGroupProps) => {
  if (!next || !previous || !goToSlide || !carouselState) return null
  return (
    <div className="carousel-button-group"> // remember to give it position:absolute
      <button className={carouselState!.currentSlide === 0 ? 'disable' : ''} onClick={() => previous()} />
      <button onClick={() => next()}>next??</button>
      <button onClick={() => goToSlide(carouselState.currentSlide + 1)}> Go to any slide </button>
    </div>
  );
};
